<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Image Resizer - Optimized</title>
    
    <!-- FAVICON -->
    <link rel="icon" href="./assets/svg/logo.svg" type="image/svg+xml">

    <!-- Preconnect for Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Non-blocking load for Google Fonts stylesheet -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" as="style" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'" />

    <!-- Non-blocking load for your Tailwind build -->
    <link rel="preload" href="./assets/style/style.css" as="style" />
    <link rel="stylesheet" href="./assets/style/style.css" media="print" onload="this.media='all'" />
    <link rel="stylesheet" href="./assets/style/style.css" />


    <script src="./assets/js/header.js" defer></script>
    <script src="./assets/js/footer.js" defer></script>
    <script src="./assets/js/main.js" defer></script>

</head>
<body class="bg-slate-200 font-sans text-slate-800 flex min-h-screen flex-col transition-colors duration-300 dark:bg-slate-900 dark:text-slate-200">

<div id="header-placeholder"></div>

<main class="flex-grow w-full">
    <div class="p-4 sm:p-6 mt-16 mx-auto">
        <div class="mb-4">
          <div id="topad-1" aria-label="Top Ad 1"></div>
        </div>

        <div class="lg:grid lg:grid-cols-[side_bar] lg:gap-4">

            <div class="min-w-0 overflow-hidden">

                <section class="bg-white p-4 sm:p-6 lg:p-8 rounded-2xl border border-indigo-300 dark:bg-slate-800 dark:border-slate-700">
                    <div class="text-center mb-8">
                        <h1 class="text-3xl p-1 lg:text-4xl font-extrabold bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 bg-clip-text text-transparent">Image Resizer</h1>
                        <p class="mt-2 max-w-2xl mx-auto text-lg text-slate-600 dark:text-slate-400">A fast and private tool to resize your images directly in your browser.</p>
                    </div>
                    
                    <!-- UPLOAD AREA -->
                    <div id="upload-section" class="w-full max-w-2xl mx-auto space-y-6">
                        <label for="file-upload" id="drop-zone" class="block text-center p-8 border-2 border-dashed border-slate-400 dark:border-slate-500 rounded-lg cursor-pointer transition-colors hover:border-indigo-600 dark:hover:border-indigo-300 bg-slate-200 dark:bg-slate-900">
                            <div class="flex flex-col items-center justify-center space-y-4">
                                <p class="text-lg font-medium text-slate-700 dark:text-slate-300">Drag & drop your image file here</p>
                                <span class="text-slate-500 text-lg font-medium dark:text-slate-400">or</span>
                                <span class="bg-indigo-600 hover:bg-indigo-700 dark:bg-indigo-500 dark:hover:bg-indigo-600 text-white font-semibold py-2.5 px-5 rounded-md text-lg z-10">Select an Image</span>
                                <p class="flex items-center text-sm text-slate-500 dark:text-slate-400 pt-2">
                                    <svg class="h-5 w-5 mr-1.5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 1a4.5 4.5 0 00-4.5 4.5V9H5a2 2 0 00-2 2v6a2 2 0 002 2h10a2 2 0 002-2v-6a2 2 0 00-2-2h-.5V5.5A4.5 4.5 0 0010 1zm3 8V5.5a3 3 0 10-6 0V9h6z" clip-rule="evenodd" /></svg>
                                    100% secure. Files are processed locally.
                                </p>
                            </div>
                        </label>
                        <input type="file" id="file-upload" accept="image/*" class="hidden">
                        <p id="file-name" class="text-center font-semibold text-indigo-600 dark:text-indigo-400"></p>
                    </div>

                    <!-- EDITOR SECTION -->
                    <div class="editor-section hidden mt-8 max-w-7xl mx-auto" id="editor-section">
                        <div class="lg:grid lg:grid-cols-2 lg:gap-8">
                            <!-- PREVIEW AREA -->
                            <div class="lg:order-2">
                                <label class="text-lg font-bold text-slate-800 dark:text-slate-100">Live Preview:</label>
                                <div id="preview-container" class="mt-2 w-full flex justify-center items-center bg-slate-100 dark:bg-slate-900 rounded-lg" style="min-height: 400px; max-height: 80vh; overflow: hidden;">
                                    <div id="canvas-wrapper" style="position: relative; line-height: 0;">
                                        <canvas id="editor-canvas"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- CONTROLS AREA -->
                            <div id="controls-area" class="controls-area space-y-6 lg:order-1 mt-6 lg:mt-0">
                                <div class="control-group">
                                    <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-100 border-b border-slate-300 dark:border-slate-600 pb-3">Resizing Settings</h2>
                                    <div class="mt-4">
                                        <label for="size-presets" class="block text-lg font-bold text-slate-700 dark:text-slate-300">Size Presets</label>
                                        <select id="size-presets" class="mt-1 block w-full px-3 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md text-base focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></select>
                                    </div>
                                    <div class="control-row flex mt-4">
                                        <div class="input-group w-1/2"><label for="resize-width">Width</label><input type="number" id="resize-width" min="1" class="mt-1 block w-full px-3 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md text-base"></div>
                                        <div class="input-group w-1/2 ml-4"><label for="resize-height">Height</label><input type="number" id="resize-height" min="1" class="mt-1 block w-full px-3 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md text-base"></div>
                                    </div>
                                    <div class="aspect-ratio-lock-container mt-4">
                                        <input type="checkbox" id="aspect-ratio-lock" checked class="h-5 w-5 rounded border-gray-300 text-indigo-600">
                                        <label for="aspect-ratio-lock" class="text-lg text-gray-900 dark:text-gray-300">Lock Aspect Ratio</label>
                                    </div>
                                    <div class="control-row mt-4">
                                        <button id="resize-btn" class="w-full text-white bg-indigo-600 hover:bg-indigo-700 font-semibold rounded-lg text-lg px-5 py-3 transition-all dark:bg-indigo-500 dark:hover:bg-indigo-600">Apply Resize</button>
                                    </div>
                                </div>

                                <div class="flex flex-col sm:flex-row gap-4 pt-4 border-t border-slate-300 dark:border-slate-600">
                                    <button id="reset-btn" class="w-full sm:w-auto bg-slate-200 hover:bg-slate-300 text-slate-800 font-semibold rounded-lg text-base px-5 py-3 transition-colors dark:bg-slate-600 dark:hover:bg-slate-500 dark:text-slate-200">Start Over</button>
                                    <div class="flex-grow flex items-center gap-2">
                                        <select id="format-select" class="w-auto px-3 py-3 bg-slate-200 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md">
                                            <option value="image/png">PNG</option>
                                            <option value="image/jpeg">JPG</option>
                                            <option value="image/webp">WEBP</option>
                                        </select>
                                        <button id="download-btn" class="w-full sm:w-auto flex-grow text-white bg-indigo-600 hover:bg-indigo-700 font-semibold rounded-lg text-lg px-5 py-3 transition-all dark:bg-indigo-500 dark:hover:bg-indigo-600">Download Image</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <div class="my-4">
                    <div id="midad-1" aria-label="Mid Ad 1"></div>
                </div>
            </div>

            <aside class="hidden lg:flex flex-col">
              <div id="sidead-1" aria-label="Sidebar Ad 1"></div>
            </aside>

            <aside class="hidden lg:flex flex-col">
              <div id="sidead-2" aria-label="Sidebar Ad 2"></div>
            </aside>
        </div>

        <div class="mb-4">
          <div id="topad-2" aria-label="Top Ad 2"></div>
        </div>
    </div>
</main>

<div id="footer-placeholder"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- Data Definitions ---
    const SIZE_PRESETS = [
        { label: "Official Document Photos", sizes: [ { name: "Passport (600×600)", value: [600, 600] }, { name: "US Visa (600×600)", value: [600, 600] }, { name: "Stamp Size (270×330)", value: [270, 330] }, { name: "ID Card (300×450)", value: [300, 450] }, { name: "Driving License (BD) (354×472)", value: [354, 472] }, { name: "PAN Card (India) (638×238)", value: [638, 238] }, { name: "Aadhar Card (India) (354×472)", value: [354, 472] } ] },
        { label: "Print Photo Sizes", sizes: [ { name: "Wallet (750×1050)", value: [750, 1050] }, { name: "4R - 4×6 in (1200×1800)", value: [1200, 1800] }, { name: "5R - 5×7 in (1500×2100)", value: [1500, 2100] }, { name: "6R - 6×8 in (1800×2400)", value: [1800, 2400] } ] },
        { label: "Facebook", sizes: [ { name: "Profile (180×180)", value: [180, 180] }, { name: "Cover (820×312)", value: [820, 312] }, { name: "Post (1200×630)", value: [1200, 630] }, { name: "Story (1080×1920)", value: [1080, 1920] } ] },
        { label: "Instagram", sizes: [ { name: "Profile (320×320)", value: [320, 320] }, { name: "Post - Square (1080×1080)", value: [1080, 1080] }, { name: "Post - Portrait (1080×1350)", value: [1080, 1350] }, { name: "Post - Landscape (1080×566)", value: [1080, 566] }, { name: "Story / Reels (1080×1920)", value: [1080, 1920] } ] }
    ];
    
    // --- UI Elements & State ---
    const ui = {};
    document.querySelectorAll('[id]').forEach(el => {
        const camelCaseId = el.id.replace(/-([a-z])/g, g => g[1].toUpperCase());
        ui[camelCaseId] = el;
    });

    const state = {
        originalImage: null,
        currentImage: null,
        isAdjustingResize: false,
    };

    // --- Utility Functions ---
    const debounce = (func, delay) => {
        let timeoutId;
        return (...args) => {
            clearTimeout(timeoutId);
            timeoutId = setTimeout(() => func.apply(this, args), delay);
        };
    };

    // --- Core Functions ---
    const setReadyState = () => {
        ui.uploadSection.classList.remove('hidden');
        ui.editorSection.classList.add('hidden');
        ui.fileName.textContent = '';
        ui.fileUpload.value = '';
        if (state.originalImage) {
            URL.revokeObjectURL(state.originalImage.src);
        }
        Object.assign(state, {
            originalImage: null,
            currentImage: null,
        });
    };

    const setFileLoadedState = (file) => {
        ui.uploadSection.classList.add('hidden');
        ui.editorSection.classList.remove('hidden');
        ui.fileName.textContent = `File: ${file.name}`;
    };

    const handleImageUpload = (file) => {
        if (!file || !file.type.startsWith("image/")) {
            alert("Please upload a valid image file.");
            return;
        }
        const image = new Image();
        image.src = URL.createObjectURL(file);
        image.onload = () => {
            state.originalImage = image;
            state.currentImage = image;
            setFileLoadedState(file);
            updateResizeInputs();
            requestAnimationFrame(drawImage);
        };
        image.onerror = () => {
            alert("The selected file could not be loaded. It may be corrupted or in an unsupported format.");
            setReadyState();
        };
    };

    const drawImage = () => {
        if (!state.currentImage) return;
        const canvas = ui.editorCanvas;
        const container = ui.previewContainer;
        const wrapper = ui.canvasWrapper;
        
        const containerRect = container.getBoundingClientRect();
        if (containerRect.width === 0 || containerRect.height === 0) return;

        const imageRatio = state.currentImage.width / state.currentImage.height;
        const containerRatio = containerRect.width / containerRect.height;
        
        let canvasWidth, canvasHeight;
        if (containerRatio > imageRatio) {
            canvasHeight = containerRect.height;
            canvasWidth = canvasHeight * imageRatio;
        } else {
            canvasWidth = containerRect.width;
            canvasHeight = canvasWidth / imageRatio;
        }

        canvas.width = canvasWidth;
        canvas.height = canvasHeight;
        wrapper.style.width = `${canvasWidth}px`;
        wrapper.style.height = `${canvasHeight}px`;

        canvas.getContext('2d').drawImage(state.currentImage, 0, 0, canvasWidth, canvasHeight);
    };

    const downloadImage = () => {
        if (!state.currentImage) return;
        const format = ui.formatSelect.value;
        const extension = format.split('/')[1];
        const link = document.createElement('a');
        
        const tempCanvas = document.createElement('canvas');
        tempCanvas.width = state.currentImage.width;
        tempCanvas.height = state.currentImage.height;
        tempCanvas.getContext('2d').drawImage(state.currentImage, 0, 0, state.currentImage.width, state.currentImage.height);

        link.href = tempCanvas.toDataURL(format, 0.95);
        link.download = `resized-image.${extension}`;
        document.body.appendChild(link); // Required for Firefox
        link.click();
        document.body.removeChild(link);
    };
    
    const populateSizePresets = () => {
        if (!ui.sizePresets) return;
        const optionsHtml = [`<option value="">Select a preset...</option>`];
        SIZE_PRESETS.forEach(category => {
            optionsHtml.push(`<optgroup label="${category.label}">`);
            category.sizes.forEach(size => {
                optionsHtml.push(`<option value="${size.value.join(',')}">${size.name}</option>`);
            });
            optionsHtml.push(`</optgroup>`);
        });
        ui.sizePresets.innerHTML = optionsHtml.join('');
    };

    const updateResizeInputs = () => {
        if (state.currentImage) {
            ui.resizeWidth.value = state.currentImage.width;
            ui.resizeHeight.value = state.currentImage.height;
        }
    };
    
    const applyResize = () => {
        if (!state.originalImage) {
            alert("No image loaded to resize.");
            return;
        }
        const width = parseInt(ui.resizeWidth.value, 10);
        const height = parseInt(ui.resizeHeight.value, 10);
        if (!isFinite(width) || !isFinite(height) || width <= 0 || height <= 0) {
            alert("Please enter valid positive numbers for width and height.");
            return;
        }

        const offscreenCanvas = new OffscreenCanvas(width, height);
        const ctx = offscreenCanvas.getContext('2d');
        ctx.drawImage(state.originalImage, 0, 0, width, height);
        
        offscreenCanvas.convertToBlob({ type: 'image/png' }).then(blob => {
            const newImage = new Image();
            newImage.onload = () => {
                URL.revokeObjectURL(newImage.src); // Clean up blob URL to prevent memory leaks
                state.currentImage = newImage;
                drawImage();
            };
            newImage.src = URL.createObjectURL(blob);
        });
    };

    // --- Event Listeners Setup ---
    function setupEventListeners() {
        window.addEventListener('resize', debounce(drawImage, 150));
        
        const dropZone = ui.dropZone;
        dropZone.addEventListener('dragover', e => {
            e.preventDefault();
            dropZone.classList.add('border-indigo-600', 'dark:border-indigo-300');
            dropZone.classList.remove('border-slate-400', 'dark:border-slate-500');
        });
        ['dragleave', 'dragend', 'drop'].forEach(type => {
            dropZone.addEventListener(type, (e) => {
                e.preventDefault();
                dropZone.classList.remove('border-indigo-600', 'dark:border-indigo-300');
            });
        });
        dropZone.addEventListener('drop', e => {
            if (e.dataTransfer.files.length) handleImageUpload(e.dataTransfer.files[0]);
        });
        
        ui.fileUpload.addEventListener("change", e => {
            if (e.target.files.length) handleImageUpload(e.target.files[0]);
        });
        
        ui.downloadBtn.addEventListener('click', downloadImage);
        ui.resetBtn.addEventListener('click', setReadyState);
        ui.resizeBtn.addEventListener('click', applyResize);

        ui.sizePresets.addEventListener('change', (e) => {
            const value = e.target.value;
            if (!value) return;
            const [width, height] = value.split(',');
            state.isAdjustingResize = true;
            ui.resizeWidth.value = width;
            ui.resizeHeight.value = height;
            state.isAdjustingResize = false;
        });

        const handleManualResizeInput = (e) => {
            if (ui.sizePresets.value) ui.sizePresets.value = '';
            if (state.isAdjustingResize || !ui.aspectRatioLock.checked || !state.originalImage) return;
            
            state.isAdjustingResize = true;
            const sourceInput = e.target;
            const aspectRatio = state.originalImage.width / state.originalImage.height;
            
            if (sourceInput === ui.resizeWidth) {
                const newHeight = Math.round(parseInt(sourceInput.value, 10) / aspectRatio);
                ui.resizeHeight.value = isNaN(newHeight) ? '' : newHeight;
            } else {
                const newWidth = Math.round(parseInt(sourceInput.value, 10) * aspectRatio);
                ui.resizeWidth.value = isNaN(newWidth) ? '' : newWidth;
            }
            state.isAdjustingResize = false;
        };
        
        ui.resizeWidth.addEventListener('input', handleManualResizeInput);
        ui.resizeHeight.addEventListener('input', handleManualResizeInput);
    }
    
    // --- Initialisation ---
    setReadyState();
    populateSizePresets();
    setupEventListeners();
});
</script>

</body>
</html>