<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>


    <!--! SEO & GEO OPTIMIZED META TAGS (VERIFIED) -->
    <title>Best Free Video to MP3 Converter - High-Quality Audio Extraction | All Tool AI</title>
    <meta name="keywords" content="video to mp3, audio extractor, video to audio, mp3 converter, free converter, online audio tool, high-quality audio, secure audio extraction, private converter, All Tool AI"/>
    <meta name="description" content="The world's best free video to MP3 converter. Instantly extract high-quality MP3 audio from any video file. Fast, private, and secure online tool from All Tool AI. Your files are processed in your browser."/>
    <meta name="author" content="All Tool AI"/>
    <link rel="canonical" href="https://www.alltoolai.com/" />
    
    <!-- FAVICON -->
    <link rel="icon" href="./assets/svg/logo.svg" type="image/svg+xml">

    <!-- LAME.js MP3 ENCODER LIBRARY -->
    <script src="https://cdn.jsdelivr.net/npm/lamejs@1.2.1/lame.min.js"></script>

    <!-- 1) Preconnect for Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- 2) Non-blocking load for Google Fonts stylesheet -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" />
    
    <!-- 3) Non-blocking load for your Tailwind build -->
    <link rel="stylesheet" href="./assets/style/style.css" />
    
    <script src="./assets/js/header.js" defer></script>
    <script src="./assets/js/footer.js" defer></script>
    <script src="./assets/js/main.js" defer></script>

    <style>
      #progress-bar.is-processing {
        background-size: 40px 40px;
        background-image: linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);
        animation: progress-bar-stripes 1s linear infinite;
      }
      @keyframes progress-bar-stripes { from { background-position: 40px 0 } to { background-position: 0 0 } }
    </style>

</head>
<body class="bg-slate-200 font-sans text-slate-800 flex min-h-screen flex-col transition-colors duration-300 dark:bg-slate-900 dark:text-slate-200">

<div id="header-placeholder"></div>

<main class="flex-grow w-full">
    <div class="p-4 sm:p-6 mt-16 mx-auto">
        <div class="mb-4">
          <div id="topad-1" aria-label="Top Ad 1"></div>
        </div>

        <div class="lg:grid lg:grid-cols-[side_bar] lg:gap-4">

            <div class="min-w-0 overflow-hidden">
                <section class="bg-white p-4 sm:p-6 lg:p-8 rounded-2xl border border-indigo-300 dark:bg-slate-800 dark:border-slate-700">
                    <div class="text-center mb-8">
                        <h1 class="text-3xl lg:text-4xl font-extrabold bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 bg-clip-text text-transparent">Free Video to MP3 Converter</h1>
                        <p class="mt-2 text-lg text-slate-600 dark:text-slate-400">Extract high-quality MP3 audio. This tool is 100% free, private, and works directly in your browser without uploading your files.</p>
                    </div>

                    <div class="w-full max-w-2xl mx-auto space-y-6" id="converter-app">
                        <!-- File Upload Area -->
                        <label id="upload-area" for="file-input" class="block text-center p-8 border-2 border-dashed border-slate-300 dark:border-slate-500 rounded-lg cursor-pointer transition-colors hover:border-indigo-500 dark:hover:border-indigo-300 bg-slate-200 dark:bg-slate-900">
                            <div class="flex flex-col items-center justify-center space-y-4 pointer-events-none">
                                <p class="text-lg font-medium text-slate-700 dark:text-slate-300">Drag & drop your video here</p>
                                <span class="text-slate-500 dark:text-slate-400">or</span>
                                <span class="bg-indigo-600 hover:bg-indigo-700 dark:bg-indigo-500 dark:hover:bg-indigo-600 text-white font-semibold py-2.5 px-5 rounded-md text-base z-10">Select a File</span>
                                <p class="flex items-center text-sm text-slate-500 dark:text-slate-400 pt-2">
                                    <svg class="h-5 w-5 mr-1.5" viewBox="0 0 20 20" fill="currentColor">
                                      <path fill-rule="evenodd" d="M10 1a4.5 4.5 0 00-4.5 4.5V9H5a2 2 0 00-2 2v6a2 2 0 002 2h10a2 2 0 002-2v-6a2 2 0 00-2-2h-.5V5.5A4.5 4.5 0 0010 1zm3 8V5.5a3 3 0 10-6 0V9h6z" clip-rule="evenodd" />
                                    </svg>
                                    100% Secure. Files are processed on your device.
                                </p>
                            </div>
                        </label>
                        <input type="file" id="file-input" accept="video/*" class="hidden">

                        <!-- Processing & Results Area -->
                        <div id="processing-area" class="hidden space-y-8 pt-4">
                            <!-- File Info -->
                            <div id="file-info-area" class="bg-slate-100 dark:bg-slate-700 p-4 rounded-xl space-y-2">
                                  <h2 class="text-xl font-bold text-slate-800 dark:text-slate-100 text-center">Selected Video File</h2>
                                  <div id="file-details" class="text-center text-base text-slate-600 dark:text-slate-400"></div>
                            </div>
                            
                            <!-- Audio Player -->
                            <div id="player-container" class="hidden bg-slate-100 dark:bg-slate-700 p-4 rounded-xl space-y-3">
                                <h3 class="text-center font-semibold text-lg text-slate-800 dark:text-slate-100">Preview Extracted Audio</h3>
                                <audio id="audio-player" class="w-full" controls></audio>
                            </div>

                            <!-- Status/Progress -->
                            <div id="status-container" class="text-center pt-2">
                                <p id="status-message" class="text-4xl font-medium"></p>
                                <div id="progress-bar-container" class="hidden w-full bg-slate-200 dark:bg-slate-700 rounded-md h-2.5 mt-2 overflow-hidden">
                                    <div id="progress-bar" class="bg-indigo-600 dark:bg-indigo-500 h-2.5 rounded-md transition-all duration-300" style="width:0%"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex flex-col sm:flex-row gap-4 pt-2">
                             <button id="convert-btn" class="w-full sm:w-auto flex-grow text-white bg-indigo-600 hover:bg-indigo-700 font-semibold rounded-lg text-base px-5 py-3 transition-all dark:bg-indigo-500 dark:hover:bg-indigo-600 disabled:bg-slate-400 dark:disabled:bg-slate-600 disabled:cursor-not-allowed" disabled>Extract MP3 Audio</button>
                             <button id="download-btn" class="w-full sm:w-auto flex-grow text-white bg-indigo-600 hover:bg-indigo-700 font-semibold rounded-lg text-base px-5 py-3 transition-colors dark:bg-indigo-500 dark:hover:bg-indigo-600 disabled:bg-slate-400 dark:disabled:bg-slate-600 disabled:cursor-not-allowed hidden" disabled>Download MP3</button>
                             <button id="reset-btn" class="w-full sm:w-auto bg-slate-200 hover:bg-slate-300 text-slate-800 font-semibold rounded-lg text-base px-5 py-3 transition-colors dark:bg-slate-600 dark:hover:bg-slate-500 dark:text-slate-200" disabled>Start Over</button>
                        </div>
                    </div>
                </section>
            </div>

            <aside class="hidden lg:flex flex-col">
              <div id="sidead-1" aria-label="Sidebar Ad 1"></div>
            </aside>

            <aside class="hidden lg:flex flex-col">
              <div id="sidead-2" aria-label="Sidebar Ad 2"></div>
            </aside>

        </div>

        <div class="mb-4">
          <div id="topad-2" aria-label="Top Ad 2"></div>
        </div>

    </div>
</main>

<!-- :: Footer PLACEHOLDER :: -->
<div id="footer-placeholder"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- Element Selectors ---
    const getEl = id => document.getElementById(id);

    const uploadArea = getEl('upload-area');
    const fileInput = getEl('file-input');
    const processingArea = getEl('processing-area');
    const fileDetails = getEl('file-details');
    const playerContainer = getEl('player-container');
    const audioPlayer = getEl('audio-player');
    const statusMessage = getEl('status-message');
    const progressBarContainer = getEl('progress-bar-container');
    const progressBar = getEl('progress-bar');
    const convertBtn = getEl('convert-btn');
    const downloadBtn = getEl('download-btn');
    const resetBtn = getEl('reset-btn');

    // --- State Variables ---
    let currentFile = null;
    let objectUrl = null;
    const audioContext = new(window.AudioContext || window.webkitAudioContext)();

    // --- Helper Functions ---
    const formatBytes = (bytes) => {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return `${parseFloat((bytes / Math.pow(k, i)).toFixed(2))} ${sizes[i]}`;
    };

    const updateStatus = (message, type = 'info') => {
        statusMessage.textContent = message;
        const colors = {
            'error': 'text-red-600 dark:text-red-500',
            'success': 'text-indigo-600 dark:text-indigo-400',
            'info': 'text-slate-600 dark:text-slate-400'
        };
        statusMessage.className = `text-base font-medium transition-colors ${colors[type]}`;
    };

    const updateProgress = (percentage) => {
        progressBar.style.width = `${percentage}%`;
    };

    // --- UI Logic ---
    const resetUI = (isError = false) => {
        if (objectUrl) URL.revokeObjectURL(objectUrl);
        objectUrl = currentFile = null;
        fileInput.value = '';

        if (!isError) {
            updateStatus('Please select a video file to begin.');
        }

        uploadArea.classList.remove('hidden', 'drag-over');
        processingArea.classList.add('hidden');
        playerContainer.classList.add('hidden');
        audioPlayer.src = '';
        audioPlayer.removeAttribute('src');

        convertBtn.disabled = true;
        downloadBtn.disabled = true;
        convertBtn.classList.remove('hidden');
        downloadBtn.classList.add('hidden');
        resetBtn.disabled = true;

        progressBarContainer.classList.add('hidden');
        updateProgress(0);
        progressBar.classList.remove('is-processing');
    };

    const handleFile = (file) => {
        resetUI();
        if (!file) return;

        if (!file.type.startsWith('video/')) {
            updateStatus('Invalid file type. Please select a video file.', 'error');
            return;
        }

        currentFile = file;
        fileDetails.innerHTML = `<p class="font-bold text-slate-700 dark:text-slate-200 truncate">${file.name}</p><p>${formatBytes(file.size)}</p>`;
        processingArea.classList.remove('hidden');
        uploadArea.classList.add('hidden');
        updateStatus('File ready. Click "Extract MP3 Audio" to begin.', 'success');
        convertBtn.disabled = false;
        resetBtn.disabled = false;
    };

    // --- Audio Processing ---
    const encodeMp3 = (audioBuffer) => {
        const channels = audioBuffer.numberOfChannels;
        const sampleRate = audioBuffer.sampleRate;
        const kbps = 128; // Standard MP3 bitrate
        const mp3encoder = new lamejs.Mp3Encoder(channels, sampleRate, kbps);
        
        // Get PCM data from each channel
        const pcmData = [];
        for (let i = 0; i < channels; i++) {
            pcmData.push(audioBuffer.getChannelData(i));
        }

        // Convert PCM float samples to 16-bit signed integers
        const to16BitInt = (floatData) => {
            const output = new Int16Array(floatData.length);
            for (let i = 0; i < floatData.length; i++) {
                const s = Math.max(-1, Math.min(1, floatData[i]));
                output[i] = s < 0 ? s * 0x8000 : s * 0x7FFF;
            }
            return output;
        };

        const samplesLeft = to16BitInt(pcmData[0]);
        const samplesRight = channels > 1 ? to16BitInt(pcmData[1]) : null;

        let remaining = samplesLeft.length;
        const maxSamples = 1152; // Max samples per frame
        const mp3Data = [];

        for (let i = 0; remaining >= maxSamples; i += maxSamples) {
            const leftChunk = samplesLeft.subarray(i, i + maxSamples);
            let rightChunk = null;
            if (channels > 1) {
                rightChunk = samplesRight.subarray(i, i + maxSamples);
            }
            const mp3buf = mp3encoder.encodeBuffer(leftChunk, rightChunk);
            if (mp3buf.length > 0) {
                mp3Data.push(new Int8Array(mp3buf));
            }
            remaining -= maxSamples;
        }

        const finalMp3buf = mp3encoder.flush();
        if (finalMp3buf.length > 0) {
            mp3Data.push(new Int8Array(finalMp3buf));
        }

        return new Blob(mp3Data, { type: 'audio/mp3' });
    };

    const processFile = (file) => {
        updateStatus('Initializing...', 'info');
        progressBarContainer.classList.remove('hidden');
        updateProgress(0);
        convertBtn.disabled = true;
        resetBtn.disabled = true;

        const reader = new FileReader();
        reader.onerror = () => {
            updateStatus('Error: Failed to read file.', 'error');
            resetUI(true);
        };
        reader.onprogress = (event) => {
            if (event.lengthComputable) {
                const percentLoaded = Math.round((event.loaded / event.total) * 50);
                updateStatus(`Reading file (${percentLoaded * 2}%)`, 'info');
                updateProgress(percentLoaded);
            }
        };
        reader.onload = async (e) => {
            try {
                updateStatus('Decoding audio...', 'info');
                updateProgress(50);
                progressBar.classList.add('is-processing');

                const decodedAudioBuffer = await audioContext.decodeAudioData(e.target.result);
                progressBar.classList.remove('is-processing');

                updateStatus('Encoding to MP3...', 'info');
                updateProgress(90);

                const mp3Blob = encodeMp3(decodedAudioBuffer);

                if (objectUrl) URL.revokeObjectURL(objectUrl);
                objectUrl = URL.createObjectURL(mp3Blob);
                audioPlayer.src = objectUrl;

                updateStatus('Extraction Complete!', 'success');
                updateProgress(100);

                playerContainer.classList.remove('hidden');
                convertBtn.classList.add('hidden');
                downloadBtn.classList.remove('hidden');
                downloadBtn.disabled = false;
                resetBtn.disabled = false;

            } catch (err) {
                console.error(err);
                updateStatus('Extraction Failed: The audio codec may not be supported.', 'error');
                resetUI(true);
            }
        };
        reader.readAsArrayBuffer(file);
    };

    // --- Event Listeners ---
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, e => {
            e.preventDefault();
            e.stopPropagation();
        });
    });
    ['dragenter', 'dragover'].forEach(eventName => {
        uploadArea.addEventListener(eventName, () => uploadArea.classList.add('border-indigo-500', 'dark:border-indigo-500'));
    });
    ['dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, () => uploadArea.classList.remove('border-indigo-500', 'dark:border-indigo-500'));
    });
    uploadArea.addEventListener('drop', e => handleFile(e.dataTransfer.files[0]));
    fileInput.addEventListener('change', () => handleFile(fileInput.files[0]));
    resetBtn.addEventListener('click', () => resetUI());
    convertBtn.addEventListener('click', () => { if (currentFile) processFile(currentFile); });
    downloadBtn.addEventListener('click', () => {
        if (!objectUrl) return;
        const a = document.createElement('a');
        a.href = objectUrl;
        a.download = `${currentFile.name.substring(0, currentFile.name.lastIndexOf('.')) || currentFile.name}.mp3`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    });
    
    // --- Initial State ---
    resetUI();
});
</script>
 
</body>
</html>
